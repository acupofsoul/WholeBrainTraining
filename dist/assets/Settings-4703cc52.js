import{j as H,C as x,k as c,c as K,J as W,l as X,o as b,a as y,b as e,s as m,x as Y,y as D,v as Z,g as h,t as B,n as _,N as O,E as $,O as tt,P as et,G as at,Q as nt,R as L,S as st,T as ot,U as it}from"./index-7434e420.js";import{_ as lt}from"./_plugin-vue_export-helper-c27b6911.js";const rt={name:"Settings",setup(){const d=H(),t=x(O()),g=c({});t.dataManagement||(t.dataManagement={autoBackupEnabled:!0,backupInterval:1});const a=c(null),w=c(!0),C=c(null),n=c(!1),f=c(""),v=c(""),u=c(null),S=c(null),i=x({show:!1,message:"",type:"info",timeout:null}),p=async()=>{try{const s=await $();Object.assign(t,s),t.dataManagement||(t.dataManagement={autoBackupEnabled:!0,backupInterval:1}),g.value=JSON.parse(JSON.stringify(t)),E(),t.dataManagement.autoBackupEnabled&&await tt(t.dataManagement.backupInterval)&&E()}catch(s){o("加载设置失败: "+s.message,"error")}},E=async()=>{try{a.value=await et()}catch(s){console.error("加载备份信息失败:",s)}},N=async()=>{try{await at(t),g.value=JSON.parse(JSON.stringify(t)),o("设置已保存","success"),U(t.theme)}catch(s){o("保存设置失败: "+s.message,"error")}},A=()=>{n.value=!0,f.value="重置设置",v.value="确定要将所有设置重置为默认值吗？",u.value=async()=>{const s=O();Object.assign(t,s),await N(),o("设置已重置为默认值","success")}},J=async()=>{try{const s=await nt(),r=JSON.stringify(s,null,2),k=new Blob([r],{type:"application/json"}),M=URL.createObjectURL(k),l=document.createElement("a");l.href=M,l.download=`whole-brain-training-data-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),o("数据导出成功","success")}catch(s){o("导出数据失败: "+s.message,"error")}},T=()=>{C.value.click()},j=s=>{const r=s.target.files[0];if(!r)return;const k=new FileReader;k.onload=async M=>{try{const l=JSON.parse(M.target.result);n.value=!0,f.value="导入数据",v.value='是否保留当前设置？选择"确认"将只导入训练数据，选择"取消"将同时导入设置和训练数据。',u.value=async()=>{try{await L(l,!0),await p(),o("数据导入成功（保留当前设置）","success")}catch(I){o("导入数据失败: "+I.message,"error")}},S.value=async()=>{try{await L(l,!1),await p(),o("数据导入成功（使用导入的设置）","success")}catch(I){o("导入数据失败: "+I.message,"error")}}}catch(l){o("无效的数据文件: "+l.message,"error")}s.target.value=""},k.onerror=()=>{o("读取文件失败","error"),s.target.value=""},k.readAsText(r)},F=()=>{n.value=!0,f.value="清除所有数据",v.value="此操作将永久删除所有训练数据"+(w.value?"，但会保留设置":"和设置")+"，无法恢复。确定要继续吗？",u.value=async()=>{try{if(await st(w.value),w.value)await p();else{const s=O();Object.assign(t,s),g.value=JSON.parse(JSON.stringify(s))}o("所有数据已清除","success")}catch(s){o("清除数据失败: "+s.message,"error")}}},V=async()=>{try{await ot(),await E(),o("备份已创建","success")}catch(s){o("创建备份失败: "+s.message,"error")}},R=()=>{f.value="从备份恢复",v.value="确定要从最后一次备份恢复数据吗？当前数据将被覆盖。",u.value=z,n.value=!0},z=async()=>{try{await it(),o("数据已从备份恢复","success"),p()}catch(s){o("恢复数据失败: "+s.message,"error")}},G=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"无",P=async()=>{u.value&&await u.value(),n.value=!1},Q=()=>{S.value&&(S.value(),S.value=null),n.value=!1},o=(s,r="info")=>{i.timeout&&clearTimeout(i.timeout),i.show=!0,i.message=s,i.type=r,i.timeout=setTimeout(()=>{i.show=!1},3e3)},U=s=>{s==="dark"?(document.documentElement.classList.add("dark-theme"),document.documentElement.classList.remove("light-theme")):s==="light"?(document.documentElement.classList.add("light-theme"),document.documentElement.classList.remove("dark-theme")):s==="auto"&&(window.matchMedia("(prefers-color-scheme: dark)").matches?(document.documentElement.classList.add("dark-theme"),document.documentElement.classList.remove("light-theme")):(document.documentElement.classList.add("light-theme"),document.documentElement.classList.remove("dark-theme")))},q=K(()=>JSON.stringify(t)!==JSON.stringify(g.value));return W(()=>d.path,s=>{s!=="/settings"&&(i.show=!1,i.timeout&&(clearTimeout(i.timeout),i.timeout=null))},{immediate:!0}),X(async()=>{await p(),U(t.theme)}),{settings:t,fileInput:C,showConfirmDialog:n,confirmDialogTitle:f,confirmDialogMessage:v,notification:i,hasUnsavedChanges:q,saveSettings:N,resetSettings:A,exportData:J,showImportDialog:T,handleFileUpload:j,confirmClearData:F,confirmDialogAction:P,cancelDialog:Q,createManualBackup:V,restoreFromBackup:R,formatBackupDate:G}}},ct={class:"settings-container"},dt={class:"settings-section"},ut={class:"setting-item"},mt={class:"setting-item"},gt={class:"setting-item"},ft={class:"settings-section"},vt={class:"setting-item"},pt={key:0,class:"setting-item"},kt={key:1,class:"setting-item"},bt={class:"info-text"},yt={class:"data-management-buttons"},wt={class:"setting-item"},St={class:"settings-actions"},Dt={key:0,class:"confirm-dialog-overlay"},ht={class:"confirm-dialog"},Bt={class:"confirm-dialog-actions"};function Ct(d,t,g,a,w,C){return b(),y("div",ct,[t[26]||(t[26]=e("h1",null,"设置",-1)),e("div",dt,[t[20]||(t[20]=e("h2",null,"应用设置",-1)),e("div",ut,[t[17]||(t[17]=e("label",{for:"theme"},"主题",-1)),m(e("select",{id:"theme","onUpdate:modelValue":t[0]||(t[0]=n=>a.settings.theme=n)},t[16]||(t[16]=[e("option",{value:"light"},"浅色",-1),e("option",{value:"dark"},"深色",-1),e("option",{value:"auto"},"跟随系统",-1)]),512),[[Y,a.settings.theme]])]),e("div",mt,[t[18]||(t[18]=e("label",{for:"sound-enabled"},"声音",-1)),m(e("input",{type:"checkbox",id:"sound-enabled","onUpdate:modelValue":t[1]||(t[1]=n=>a.settings.soundEnabled=n)},null,512),[[D,a.settings.soundEnabled]])]),e("div",gt,[t[19]||(t[19]=e("label",{for:"notifications-enabled"},"通知",-1)),m(e("input",{type:"checkbox",id:"notifications-enabled","onUpdate:modelValue":t[2]||(t[2]=n=>a.settings.notificationsEnabled=n)},null,512),[[D,a.settings.notificationsEnabled]])])]),e("div",ft,[t[25]||(t[25]=e("h2",null,"数据管理",-1)),e("div",vt,[t[21]||(t[21]=e("label",{for:"auto-backup-enabled"},"启用自动备份",-1)),m(e("input",{type:"checkbox",id:"auto-backup-enabled","onUpdate:modelValue":t[3]||(t[3]=n=>a.settings.dataManagement.autoBackupEnabled=n)},null,512),[[D,a.settings.dataManagement.autoBackupEnabled]])]),a.settings.dataManagement.autoBackupEnabled?(b(),y("div",pt,[t[22]||(t[22]=e("label",{for:"backup-interval"},"备份间隔（天）",-1)),m(e("input",{type:"number",id:"backup-interval","onUpdate:modelValue":t[4]||(t[4]=n=>a.settings.dataManagement.backupInterval=n),min:"1",max:"30",step:"1"},null,512),[[Z,a.settings.dataManagement.backupInterval,void 0,{number:!0}]])])):h("",!0),d.lastBackupInfo?(b(),y("div",kt,[t[23]||(t[23]=e("label",null,"上次备份时间",-1)),e("div",bt,B(a.formatBackupDate(d.lastBackupInfo.date)),1),e("button",{onClick:t[5]||(t[5]=(...n)=>a.restoreFromBackup&&a.restoreFromBackup(...n)),class:"btn secondary small"},"从备份恢复")])):h("",!0),e("div",yt,[e("button",{onClick:t[6]||(t[6]=(...n)=>a.exportData&&a.exportData(...n)),class:"btn primary"},"导出数据"),e("button",{onClick:t[7]||(t[7]=(...n)=>a.showImportDialog&&a.showImportDialog(...n)),class:"btn secondary"},"导入数据"),e("button",{onClick:t[8]||(t[8]=(...n)=>a.createManualBackup&&a.createManualBackup(...n)),class:"btn primary"},"立即备份"),e("button",{onClick:t[9]||(t[9]=(...n)=>a.confirmClearData&&a.confirmClearData(...n)),class:"btn danger"},"清除所有数据")]),e("div",wt,[t[24]||(t[24]=e("label",{for:"keep-settings"},"清除数据时保留设置",-1)),m(e("input",{type:"checkbox",id:"keep-settings","onUpdate:modelValue":t[10]||(t[10]=n=>d.keepSettings=n)},null,512),[[D,d.keepSettings]])]),e("input",{type:"file",ref:"fileInput",style:{display:"none"},onChange:t[11]||(t[11]=(...n)=>a.handleFileUpload&&a.handleFileUpload(...n)),accept:".json"},null,544)]),e("div",St,[e("button",{onClick:t[12]||(t[12]=(...n)=>a.saveSettings&&a.saveSettings(...n)),class:"btn primary"},"保存设置"),e("button",{onClick:t[13]||(t[13]=(...n)=>a.resetSettings&&a.resetSettings(...n)),class:"btn secondary"},"重置为默认")]),a.showConfirmDialog?(b(),y("div",Dt,[e("div",ht,[e("h3",null,B(a.confirmDialogTitle),1),e("p",null,B(a.confirmDialogMessage),1),e("div",Bt,[e("button",{onClick:t[14]||(t[14]=(...n)=>a.confirmDialogAction&&a.confirmDialogAction(...n)),class:"btn danger"},"确认"),e("button",{onClick:t[15]||(t[15]=(...n)=>a.cancelDialog&&a.cancelDialog(...n)),class:"btn secondary"},"取消")])])])):h("",!0),a.notification.show?(b(),y("div",{key:1,class:_(["notification",a.notification.type])},B(a.notification.message),3)):h("",!0)])}const It=lt(rt,[["render",Ct],["__scopeId","data-v-ca10a289"]]);export{It as default};
