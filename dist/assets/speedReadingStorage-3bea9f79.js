import"./index-e0b54b24.js";const o={ARTICLE_READING_HISTORY:"articleReadingHistory",ARTICLE_READING_SETTINGS:"articleReadingSettings",THREED_READING_HISTORY:"threeDReadingHistory",THREED_READING_SETTINGS:"threeDReadingSettings",SPEED_READING_STATS:"speedReadingStats"};function g(){return{readingSpeed:300,displayMode:"word",fontSize:"medium",lineHeight:"normal",wordSpacing:"normal",backgroundColor:"white",highlightColor:"#007bff",showProgress:!0,enableSound:!1,autoAdjustSpeed:!1,minSpeed:100,maxSpeed:1e3}}function S(){return{initialDisplayTime:3,imageSize:"medium",showFocusGuide:!0,showTips:!0,backgroundColor:"black",enableSound:!1,difficulty:"medium",layerSeparation:20,animationSpeed:"normal",contrastLevel:"medium",blurEffect:!1,rotationEffect:!1,pulseEffect:!1,autoAdjustDifficulty:!1,minDisplayTime:1,maxDisplayTime:10,feedbackType:"visual"}}function d(){return{articleReading:{totalSessions:0,averageSpeed:0,averageAccuracy:0,totalTime:0,bestSpeed:0,speedLevel:0,comprehensionLevel:0,focusLevel:0},threeDReading:{totalSessions:0,averageAccuracy:0,averageTime:0,totalTime:0,stereoVision:0,spatialPerception:0,depthPerception:0,visualFocus:0},overall:{totalTrainingTime:0,totalSessions:0,lastTrainingDate:null,weeklyGoal:300,monthlyGoal:1200}}}async function I(t){try{return localStorage.setItem(o.ARTICLE_READING_SETTINGS,JSON.stringify(t)),!0}catch(a){return console.error("保存文章阅读设置失败:",a),!1}}async function A(){try{const t=localStorage.getItem(o.ARTICLE_READING_SETTINGS);return t?{...g(),...JSON.parse(t)}:g()}catch(t){return console.error("获取文章阅读设置失败:",t),g()}}async function w(t){try{return localStorage.setItem(o.THREED_READING_SETTINGS,JSON.stringify(t)),!0}catch(a){return console.error("保存3D阅读设置失败:",a),!1}}async function N(){try{const t=localStorage.getItem(o.THREED_READING_SETTINGS);return t?{...S(),...JSON.parse(t)}:S()}catch(t){return console.error("获取3D阅读设置失败:",t),S()}}async function _(t){try{const a=await D(),e={...t,id:Date.now(),timestamp:new Date().toISOString()},s=[e,...a].slice(0,100);return localStorage.setItem(o.ARTICLE_READING_HISTORY,JSON.stringify(s)),await m(e),!0}catch(a){return console.error("保存文章阅读记录失败:",a),!1}}async function D(){try{const t=localStorage.getItem(o.ARTICLE_READING_HISTORY);return t?JSON.parse(t):[]}catch(t){return console.error("获取文章阅读历史失败:",t),[]}}async function G(t){try{const a=await y(),e={...t,id:Date.now(),timestamp:new Date().toISOString()},s=[e,...a].slice(0,100);return localStorage.setItem(o.THREED_READING_HISTORY,JSON.stringify(s)),await p(e),!0}catch(a){return console.error("保存3D阅读记录失败:",a),!1}}async function y(){try{const t=localStorage.getItem(o.THREED_READING_HISTORY);return t?JSON.parse(t):[]}catch(t){return console.error("获取3D阅读历史失败:",t),[]}}async function m(t){try{const a=await T(),e=a.articleReading;return e.totalSessions+=1,e.totalSessions===1?e.averageSpeed=t.speed:e.averageSpeed=(e.averageSpeed*(e.totalSessions-1)+t.speed)/e.totalSessions,e.totalSessions===1?e.averageAccuracy=t.accuracy:e.averageAccuracy=(e.averageAccuracy*(e.totalSessions-1)+t.accuracy)/e.totalSessions,(!e.bestSpeed||t.speed>e.bestSpeed)&&(e.bestSpeed=t.speed),e.totalTime+=t.time,e.speedLevel=Math.min(100,e.averageSpeed/500*100),e.comprehensionLevel=e.averageAccuracy,e.focusLevel=Math.min(100,e.totalSessions/50*100),a.overall.totalSessions+=1,a.overall.totalTrainingTime+=t.time,a.overall.lastTrainingDate=new Date().toISOString(),await f(a),!0}catch(a){return console.error("更新文章阅读统计失败:",a),!1}}async function p(t){try{const a=await T(),e=a.threeDReading;return e.totalSessions+=1,e.totalSessions===1?e.averageAccuracy=t.accuracy:e.averageAccuracy=(e.averageAccuracy*(e.totalSessions-1)+t.accuracy)/e.totalSessions,e.totalSessions===1?e.averageTime=t.averageTime:e.averageTime=(e.averageTime*(e.totalSessions-1)+t.averageTime)/e.totalSessions,e.totalTime+=t.totalTime,e.stereoVision=Math.min(100,e.averageAccuracy),e.spatialPerception=Math.min(100,e.totalSessions/20*100),e.depthPerception=Math.min(100,Math.max(0,100-(e.averageTime-3)*20)),e.visualFocus=Math.min(100,(e.stereoVision+e.depthPerception)/2),a.overall.totalSessions+=1,a.overall.totalTrainingTime+=t.totalTime,a.overall.lastTrainingDate=new Date().toISOString(),await f(a),!0}catch(a){return console.error("更新3D阅读统计失败:",a),!1}}async function T(){try{const t=localStorage.getItem(o.SPEED_READING_STATS);return t?{...d(),...JSON.parse(t)}:d()}catch(t){return console.error("获取速读统计数据失败:",t),d()}}async function f(t){try{return localStorage.setItem(o.SPEED_READING_STATS,JSON.stringify(t)),!0}catch(a){return console.error("保存速读统计数据失败:",a),!1}}async function O(t=30){try{const a=await D(),e=await y(),s=new Date;s.setDate(s.getDate()-t);const r=a.filter(l=>new Date(l.timestamp)>=s),n=e.filter(l=>new Date(l.timestamp)>=s),i=h(r),c=R([...r,...n]),u=E([...r,...n],t);return{speedTrend:i,accuracyTrend:c,trainingFrequency:u,totalSessions:r.length+n.length,averageSessionsPerWeek:(r.length+n.length)/t*7}}catch(a){return console.error("获取训练进度失败:",a),{speedTrend:[],accuracyTrend:[],trainingFrequency:[],totalSessions:0,averageSessionsPerWeek:0}}}function h(t){const a=[],e={};return t.forEach(s=>{const r=new Date(s.timestamp).toDateString();e[r]||(e[r]=[]),e[r].push(s.speed)}),Object.keys(e).sort().forEach(s=>{const r=e[s],n=r.reduce((i,c)=>i+c,0)/r.length;a.push({date:s,speed:Math.round(n),sessions:r.length})}),a}function R(t){const a=[],e={};return t.forEach(s=>{const r=new Date(s.timestamp).toDateString();e[r]||(e[r]=[]),e[r].push(s.accuracy)}),Object.keys(e).sort().forEach(s=>{const r=e[s],n=r.reduce((i,c)=>i+c,0)/r.length;a.push({date:s,accuracy:Math.round(n),sessions:r.length})}),a}function E(t,a){const e=[],s=new Date;for(let r=a-1;r>=0;r--){const n=new Date(s);n.setDate(n.getDate()-r);const i=n.toDateString(),c=t.filter(u=>new Date(u.timestamp).toDateString()===i);e.push({date:i,sessions:c.length,totalTime:c.reduce((u,l)=>u+(l.time||l.totalTime||0),0)})}return e}export{O as a,_ as b,A as c,I as d,y as e,G as f,T as g,N as h,w as i,f as s};
