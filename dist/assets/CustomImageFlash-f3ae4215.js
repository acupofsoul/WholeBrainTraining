import{i as re,k as d,c as b,q as ue,o as r,a as u,b as e,z as E,t as i,F as O,h as U,g as _,m as de,n as ce,s as C,x as V,d as ve,y as me}from"./index-7434e420.js";import{_ as pe}from"./_plugin-vue_export-helper-c27b6911.js";const ge={class:"custom-image-flash"},_e={key:0,class:"setup-stage"},he={class:"setup-container"},fe={class:"image-upload-section"},be={class:"upload-area"},Ie={key:0,class:"image-preview"},ke={class:"image-grid"},ye=["src","alt"],Se={class:"image-info"},Te={class:"image-name"},Ce=["onClick"],we={class:"training-groups-section"},De={class:"groups-container"},Me={class:"group-header"},Ge=["onClick"],$e={class:"group-images"},Fe={class:"image-selector"},Oe=["onClick"],Ue=["src","alt"],Ve={class:"selection-info"},Ne={class:"group-parameters"},Pe={class:"parameter-grid"},Re={class:"parameter-item"},Je=["onUpdate:modelValue"],ze={class:"parameter-item"},Be=["onUpdate:modelValue"],Ee={class:"parameter-item"},Ae=["onUpdate:modelValue"],Le={class:"parameter-item"},qe={class:"toggle-switch"},xe=["onUpdate:modelValue","id"],We=["for"],je={class:"group-preview"},He={class:"preview-item"},Ke={class:"preview-item"},Qe={class:"overall-preview"},Xe={class:"overall-stats"},Ye={class:"stat-item"},Ze={class:"stat-value"},es={class:"stat-item"},ss={class:"stat-value"},ts={class:"stat-item"},as={class:"stat-value"},ls={class:"action-buttons"},os=["disabled"],ns={key:1,class:"training-stage"},is={class:"training-header"},rs={class:"training-info"},us={class:"group-info"},ds={class:"image-info"},cs={class:"progress-bar"},vs={class:"flash-area"},ms=["src"],ps={key:1,class:"flash-placeholder"},gs={class:"waiting-indicator"},_s={class:"training-controls"},hs={key:2,class:"result-stage"},fs={class:"result-stats"},bs={class:"stat-card"},Is={class:"stat-number"},ks={class:"stat-card"},ys={class:"stat-number"},Ss={class:"stat-card"},Ts={class:"stat-number"},Cs={class:"stat-card"},ws={class:"stat-number"},Ds={__name:"CustomImageFlash",setup(Ms){const A=re(),m=d("setup"),p=d([]),o=d([{selectedImages:[],params:{speed:1e3,interval:1e3,rounds:1,randomOrder:!1}}]),c=d(0),v=d(0),h=d(1),w=d(""),D=d(!1),f=d(!1),S=d([]),T=d("准备中..."),N=d(0),M=d(0),G=d(0);let I=null,k=null;const y=b(()=>o.value[c.value]||o.value[0]),P=b(()=>o.value.reduce((a,s)=>a+s.selectedImages.length,0)),L=b(()=>{const a=o.value.reduce((l,n)=>{const g=n.selectedImages.length*(parseInt(n.params.speed)+parseInt(n.params.interval))*n.params.rounds;return l+g},0),s=Math.floor(a/6e4),t=Math.floor(a%6e4/1e3);return`${s}分${t}秒`}),R=b(()=>o.value.some(a=>a.selectedImages.length>0)),q=b(()=>{let a=0,s=0;for(let t=0;t<o.value.length;t++){const l=o.value[t],n=l.selectedImages.length*l.params.rounds;if(s+=n,t<c.value)a+=n;else if(t===c.value){const g=(h.value-1)*l.selectedImages.length+v.value;a+=g}}return s>0?Math.round(a/s*100):0}),J=b(()=>{if(o.value.length===0)return 0;const a=o.value.reduce((s,t)=>s+parseInt(t.params.speed),0);return Math.round(a/o.value.length)}),x=a=>{const s=Array.from(a.target.files);z(s)},W=a=>{a.preventDefault();const t=Array.from(a.dataTransfer.files).filter(l=>l.type.startsWith("image/"));z(t)},z=a=>{a.forEach(s=>{const t=new FileReader;t.onload=l=>{p.value.push({name:s.name,url:l.target.result,file:s})},t.readAsDataURL(s)})},j=a=>{p.value.splice(a,1),o.value.forEach(s=>{s.selectedImages=s.selectedImages.filter(t=>t!==a).map(t=>t>a?t-1:t)})},H=()=>{o.value.push({selectedImages:[],params:{speed:1e3,interval:1e3,rounds:1,randomOrder:!1}})},K=a=>{o.value.splice(a,1)},Q=(a,s)=>{const t=o.value[a],l=t.selectedImages.indexOf(s);l>-1?t.selectedImages.splice(l,1):t.selectedImages.push(s)},X=a=>{const s=a.selectedImages.length*(parseInt(a.params.speed)+parseInt(a.params.interval))*a.params.rounds,t=Math.floor(s/6e4),l=Math.floor(s%6e4/1e3);return`${t}分${l}秒`},B=()=>{!R.value||o.value.filter(s=>s.selectedImages.length>0).length===0||(m.value="training",c.value=0,v.value=0,h.value=1,N.value=Date.now(),G.value=P.value,$(),F())},$=()=>{const a=o.value[c.value],s=a.selectedImages.map(t=>p.value[t].url);S.value=a.params.randomOrder?[...s].sort(()=>Math.random()-.5):[...s]},F=()=>{if(!f.value){if(v.value>=S.value.length)if(h.value>=y.value.params.rounds)if(c.value++,c.value>=o.value.length){se();return}else v.value=0,h.value=1,$();else h.value++,v.value=0,y.value.params.randomOrder&&$();w.value=S.value[v.value],D.value=!0,T.value="准备中...",I=setTimeout(()=>{D.value=!1,T.value="间隔中...",k=setTimeout(()=>{v.value++,F()},parseInt(y.value.params.interval))},parseInt(y.value.params.speed))}},Y=()=>{f.value=!0,clearTimeout(I),clearTimeout(k),T.value="已暂停"},Z=()=>{f.value=!1,F()},ee=()=>{clearTimeout(I),clearTimeout(k),m.value="setup",f.value=!1},se=()=>{clearTimeout(I),clearTimeout(k),M.value=Date.now()-N.value,m.value="result",ne()},te=()=>{B()},ae=()=>{m.value="setup"},le=()=>{A.push("/flash-training")},oe=a=>{const s=Math.floor(a/6e4),t=Math.floor(a%6e4/1e3);return`${s}分${t}秒`},ne=()=>{const a={date:new Date().toISOString(),groupCount:o.value.length,imageCount:G.value,duration:M.value,averageSpeed:J.value},s=localStorage.getItem("customImageFlashRecords")||"[]",t=JSON.parse(s);t.push(a),localStorage.setItem("customImageFlashRecords",JSON.stringify(t)),ie()},ie=()=>{const a=JSON.parse(localStorage.getItem("flashTrainingStats")||"{}");a.customImage||(a.customImage={completed:0,bestScore:0}),a.customImage.completed++,localStorage.setItem("flashTrainingStats",JSON.stringify(a))};return ue(()=>{clearTimeout(I),clearTimeout(k)}),(a,s)=>(r(),u("div",ge,[m.value==="setup"?(r(),u("div",_e,[s[22]||(s[22]=e("div",{class:"page-header"},[e("h1",null,"自定义图片闪视训练"),e("p",{class:"page-description"}," 上传您的图片，设置多组闪视参数，进行个性化的图像记忆训练 ")],-1)),e("div",he,[e("div",fe,[s[4]||(s[4]=e("h3",null,"图片上传",-1)),e("div",be,[e("div",{class:"upload-drop-zone",onDrop:W,onDragover:s[0]||(s[0]=E(()=>{},["prevent"])),onDragenter:s[1]||(s[1]=E(()=>{},["prevent"])),onClick:s[2]||(s[2]=t=>a.$refs.imageInput.click())},[e("input",{type:"file",ref:"imageInput",onChange:x,accept:"image/*",multiple:"",style:{display:"none"}},null,544),s[3]||(s[3]=e("div",{class:"upload-content"},[e("div",{class:"upload-icon"},"🖼️"),e("p",null,"拖拽图片到此处或点击上传"),e("p",{class:"upload-hint"},"支持 JPG、PNG、GIF 格式，可多选")],-1))],32)]),p.value.length>0?(r(),u("div",Ie,[e("h4",null,"已上传图片 ("+i(p.value.length)+"张)",1),e("div",ke,[(r(!0),u(O,null,U(p.value,(t,l)=>(r(),u("div",{key:l,class:"image-item"},[e("img",{src:t.url,alt:t.name,class:"preview-image"},null,8,ye),e("div",Se,[e("span",Te,i(t.name),1),e("button",{onClick:n=>j(l),class:"remove-btn"},"×",8,Ce)])]))),128))])])):_("",!0)]),e("div",we,[s[16]||(s[16]=e("h3",null,"训练组设置",-1)),s[17]||(s[17]=e("p",{class:"section-description"},"为不同的图片组设置不同的闪视参数",-1)),e("div",De,[(r(!0),u(O,null,U(o.value,(t,l)=>(r(),u("div",{key:l,class:"group-card"},[e("div",Me,[e("h4",null,"训练组 "+i(l+1),1),o.value.length>1?(r(),u("button",{key:0,onClick:n=>K(l),class:"remove-group-btn"}," 删除 ",8,Ge)):_("",!0)]),e("div",$e,[s[6]||(s[6]=e("label",null,"选择图片：",-1)),e("div",Fe,[(r(!0),u(O,null,U(p.value,(n,g)=>(r(),u("div",{key:g,class:ce(["selectable-image",{selected:t.selectedImages.includes(g)}]),onClick:Gs=>Q(l,g)},[e("img",{src:n.url,alt:n.name},null,8,Ue),s[5]||(s[5]=e("div",{class:"selection-overlay"},[e("span",{class:"check-icon"},"✓")],-1))],10,Oe))),128))]),e("div",Ve," 已选择 "+i(t.selectedImages.length)+" 张图片 ",1)]),e("div",Ne,[e("div",Pe,[e("div",Re,[s[8]||(s[8]=e("label",null,"闪视速度",-1)),C(e("select",{"onUpdate:modelValue":n=>t.params.speed=n},s[7]||(s[7]=[ve('<option value="2000" data-v-400596f0>很慢 (2秒)</option><option value="1500" data-v-400596f0>慢速 (1.5秒)</option><option value="1000" data-v-400596f0>中速 (1秒)</option><option value="500" data-v-400596f0>快速 (0.5秒)</option><option value="300" data-v-400596f0>很快 (0.3秒)</option><option value="200" data-v-400596f0>极速 (0.2秒)</option>',6)]),8,Je),[[V,t.params.speed]])]),e("div",ze,[s[10]||(s[10]=e("label",null,"间隔时间",-1)),C(e("select",{"onUpdate:modelValue":n=>t.params.interval=n},s[9]||(s[9]=[e("option",{value:"500"},"0.5秒",-1),e("option",{value:"1000"},"1秒",-1),e("option",{value:"1500"},"1.5秒",-1),e("option",{value:"2000"},"2秒",-1)]),8,Be),[[V,t.params.interval]])]),e("div",Ee,[s[12]||(s[12]=e("label",null,"重复次数",-1)),C(e("select",{"onUpdate:modelValue":n=>t.params.rounds=n},s[11]||(s[11]=[e("option",{value:"1"},"1次",-1),e("option",{value:"2"},"2次",-1),e("option",{value:"3"},"3次",-1),e("option",{value:"5"},"5次",-1)]),8,Ae),[[V,t.params.rounds]])]),e("div",Le,[s[13]||(s[13]=e("label",null,"随机顺序",-1)),e("div",qe,[C(e("input",{type:"checkbox","onUpdate:modelValue":n=>t.params.randomOrder=n,id:`random-toggle-${l}`},null,8,xe),[[me,t.params.randomOrder]]),e("label",{for:`random-toggle-${l}`,class:"toggle-label"},null,8,We)])])]),e("div",je,[e("div",He,[s[14]||(s[14]=e("span",null,"图片数量：",-1)),e("span",null,i(t.selectedImages.length),1)]),e("div",Ke,[s[15]||(s[15]=e("span",null,"预计时长：",-1)),e("span",null,i(X(t)),1)])])])]))),128))]),e("button",{onClick:H,class:"add-group-btn"}," + 添加训练组 ")])]),e("div",Qe,[s[21]||(s[21]=e("h3",null,"训练总览",-1)),e("div",Xe,[e("div",Ye,[s[18]||(s[18]=e("span",{class:"stat-label"},"总训练组数：",-1)),e("span",Ze,i(o.value.length),1)]),e("div",es,[s[19]||(s[19]=e("span",{class:"stat-label"},"总图片数：",-1)),e("span",ss,i(P.value),1)]),e("div",ts,[s[20]||(s[20]=e("span",{class:"stat-label"},"预计总时长：",-1)),e("span",as,i(L.value),1)])]),e("div",ls,[e("button",{onClick:B,disabled:!R.value,class:"start-btn"}," 开始训练 ",8,os)])])])):_("",!0),m.value==="training"?(r(),u("div",ns,[e("div",is,[e("div",rs,[e("div",us,[e("span",null,"训练组："+i(c.value+1)+" / "+i(o.value.length),1),e("span",null,"轮次："+i(h.value)+" / "+i(y.value.params.rounds),1)]),e("div",ds,[e("span",null,"图片："+i(v.value+1)+" / "+i(S.value.length),1)])]),e("div",cs,[e("div",{class:"progress-fill",style:de({width:q.value+"%"})},null,4)])]),e("div",vs,[D.value?(r(),u("div",{class:"flash-image-container",key:w.value},[e("img",{src:w.value,alt:"Flash Image",class:"flash-image"},null,8,ms)])):(r(),u("div",ps,[e("div",gs,i(T.value),1)]))]),e("div",_s,[f.value?_("",!0):(r(),u("button",{key:0,onClick:Y,class:"control-btn pause-btn"}," ⏸️ 暂停 ")),f.value?(r(),u("button",{key:1,onClick:Z,class:"control-btn resume-btn"}," ▶️ 继续 ")):_("",!0),e("button",{onClick:ee,class:"control-btn stop-btn"}," ⏹️ 停止 ")])])):_("",!0),m.value==="result"?(r(),u("div",hs,[s[27]||(s[27]=e("div",{class:"result-header"},[e("h2",null,"训练完成！"),e("div",{class:"completion-icon"},"🎉")],-1)),e("div",fs,[e("div",bs,[e("div",Is,i(o.value.length),1),s[23]||(s[23]=e("div",{class:"stat-label"},"训练组数",-1))]),e("div",ks,[e("div",ys,i(G.value),1),s[24]||(s[24]=e("div",{class:"stat-label"},"训练图片数",-1))]),e("div",Ss,[e("div",Ts,i(oe(M.value)),1),s[25]||(s[25]=e("div",{class:"stat-label"},"训练时长",-1))]),e("div",Cs,[e("div",ws,i(J.value)+"ms",1),s[26]||(s[26]=e("div",{class:"stat-label"},"平均速度",-1))])]),e("div",{class:"result-actions"},[e("button",{onClick:te,class:"action-btn primary"}," 重新训练 "),e("button",{onClick:ae,class:"action-btn secondary"}," 修改设置 "),e("button",{onClick:le,class:"action-btn secondary"}," 返回主页 ")])])):_("",!0)]))}},Os=pe(Ds,[["__scopeId","data-v-400596f0"]]);export{Os as default};
