import{s as l,b as r,c as v}from"./configService-cad34a82.js";import{i as d,c as f,k as F,A as T}from"./index-e0b54b24.js";const o={imageFlash:{imageCount:20,displayTime:1e3,intervalTime:500,difficulty:"medium",imageSize:"medium",imageType:"mixed",showProgress:!0,randomOrder:!0,autoStart:!1,soundEnabled:!0,fullScreen:!1,showFeedback:!0,detailedStats:!0,saveResults:!0},articleFlash:{articleLength:"medium",displayTime:3e3,difficulty:"medium",fontSize:"medium",fontFamily:"default",lineHeight:"normal",showProgress:!0,randomOrder:!0,autoStart:!1,soundEnabled:!0,fullScreen:!1,showFeedback:!0,comprehensionTest:!0,saveResults:!0},expandVision:{gridSize:3,displayTime:2e3,intervalTime:1e3,difficulty:"medium",dotSize:"medium",dotColor:"#007bff",backgroundColor:"#ffffff",showGrid:!1,sessionCount:10,autoProgress:!0,adaptiveDifficulty:!1,showFeedback:!0,soundEnabled:!0,saveResults:!0},attention:{taskType:"color",difficulty:"medium",sessionDuration:300,stimulusCount:50,stimulusInterval:2e3,targetProbability:.3,stimulusSize:"medium",backgroundColor:"#f8f9fa",showProgress:!0,adaptiveDifficulty:!1,soundEnabled:!0,vibrationEnabled:!1,showFeedback:!0,realtimeFeedback:!1,saveResults:!0}},m={easy:{label:"简单",value:"easy",multiplier:.7},medium:{label:"中等",value:"medium",multiplier:1},hard:{label:"困难",value:"hard",multiplier:1.3},expert:{label:"专家",value:"expert",multiplier:1.6}},I={practice:{label:"练习模式",value:"practice",description:"自由练习，不计入成绩"},training:{label:"训练模式",value:"training",description:"正式训练，记录进度"},challenge:{label:"挑战模式",value:"challenge",description:"高难度挑战"}};function P(e){if(!e||!o[e])throw new Error(`无效的训练类型: ${e}`);const t=d({...o[e]}),s=d(!0),u=d(null);let c=null;const g=async()=>{try{s.value=!0,u.value=null;const i=await l.getSettings(r.TRAINING,e,o[e]);t.value={...o[e],...i},c=l.addListener(r.TRAINING,h)}catch(i){console.error("初始化训练设置失败:",i),u.value=i.message,t.value={...o[e]}}finally{s.value=!1}},h=({category:i,key:a,value:n})=>{i===r.TRAINING&&a===e&&(t.value={...t.value,...n})},S=async(i,a={})=>{try{const n={...t.value,...i};t.value=n,await l.saveSettings(r.TRAINING,e,n,{immediate:a.immediate||!1,backup:a.backup!==!1,notify:a.notify!==!1}),v.setConfig(`training.${e}`,n)}catch(n){throw console.error("更新训练设置失败:",n),u.value=n.message,n}},y=async(i={})=>{try{const a={...o[e]};t.value=a,await l.resetSettings(r.TRAINING,e),await l.saveSettings(r.TRAINING,e,a,{immediate:!0,backup:i.backup!==!1}),v.setConfig(`training.${e}`,a)}catch(a){throw console.error("重置训练设置失败:",a),u.value=a.message,a}},k=async()=>{try{return await l.exportAllSettings()}catch(i){throw console.error("导出训练设置失败:",i),i}},p=async(i,a={})=>{try{await l.importSettings(i,a),await g()}catch(n){throw console.error("导入训练设置失败:",n),n}},b=f(()=>m[t.value.difficulty]||m.medium),w=f(()=>{const i=R(e,t.value),a=b.value.multiplier;return Math.round(i*a)}),C=f(()=>E(e,t.value));return F(()=>{g()}),T(()=>{c&&c()}),{settings:t,isLoading:s,error:u,difficultyLevels:m,trainingModes:I,currentDifficulty:b,estimatedDuration:w,settingsSections:C,updateSettings:S,resetSettings:y,exportSettings:k,importSettings:p}}function R(e,t){switch(e){case"imageFlash":return(t.displayTime+t.intervalTime)*t.imageCount/1e3;case"articleFlash":return t.displayTime*3/1e3;case"expandVision":return(t.displayTime+t.intervalTime)*t.sessionCount/1e3;case"attention":return t.sessionDuration;default:return 300}}function E(e,t){const s={basic:{title:"基础设置",icon:"settings",settings:[]},advanced:{title:"高级设置",icon:"tune",settings:[]},feedback:{title:"反馈设置",icon:"feedback",settings:[]}};switch(e){case"imageFlash":return{...s,basic:{...s.basic,settings:["imageCount","displayTime","intervalTime","difficulty"]},visual:{title:"视觉设置",icon:"visibility",settings:["imageSize","imageType","showProgress"]},advanced:{...s.advanced,settings:["randomOrder","autoStart","soundEnabled","fullScreen"]},feedback:{...s.feedback,settings:["showFeedback","detailedStats","saveResults"]}};case"articleFlash":return{...s,basic:{...s.basic,settings:["articleLength","displayTime","difficulty"]},content:{title:"内容设置",icon:"text_fields",settings:["fontSize","fontFamily","lineHeight","showProgress"]},advanced:{...s.advanced,settings:["randomOrder","autoStart","soundEnabled","fullScreen"]},feedback:{...s.feedback,settings:["showFeedback","comprehensionTest","saveResults"]}};case"expandVision":return{...s,basic:{...s.basic,settings:["gridSize","displayTime","intervalTime","difficulty"]},visual:{title:"视觉设置",icon:"visibility",settings:["dotSize","dotColor","backgroundColor","showGrid"]},training:{title:"训练设置",icon:"fitness_center",settings:["sessionCount","autoProgress","adaptiveDifficulty"]},feedback:{...s.feedback,settings:["showFeedback","soundEnabled","saveResults"]}};case"attention":return{...s,basic:{...s.basic,settings:["taskType","difficulty","sessionDuration"]},stimulus:{title:"刺激设置",icon:"flash_on",settings:["stimulusCount","stimulusInterval","targetProbability"]},visual:{title:"视觉设置",icon:"visibility",settings:["stimulusSize","backgroundColor","showProgress"]},advanced:{...s.advanced,settings:["adaptiveDifficulty","soundEnabled","vibrationEnabled"]},feedback:{...s.feedback,settings:["showFeedback","realtimeFeedback","saveResults"]}};default:return s}}export{P as u};
